<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game</title>
    <script src="dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

	var config = {

		type: Phaser.AUTO,
		width: 800,
		height: 600,
		physics: {
			default: 'arcade',
			arcade: {
				//gravity: { y: 300 },
				debug: true
				//fps: 130
			}

		},
		scene: {

			preload: preload,
			create: create,
			update: update

		}

	};

//Globals
var score = 0;
var scoreText;

var platforms;
var player;
var cursors;
var stars;

var bombs;

var game = new Phaser.Game(config);
var gameOver;
// END Globals

function preload()
{

	this.load.image('sky','assets/sky.png');
	this.load.image('ground','assets/platform.png');
	this.load.image('star','assets/star.png');
	this.load.image('bomb','assets/bomb.png');
	this.load.spritesheet('dude','assets/dude.png',{ frameWidth: 32, frameHeight: 48 });
}

function create()
{

	this.add.image(400,300, 'sky');
	scoreText = this.add.text(16,16, 'Score: 0', { fontSize: '32px', fill: '#000' });

	// Platforms	
	platforms = this.physics.add.staticGroup();

	platforms.create(400,568, 'ground', {immovable: true}).setScale(2).refreshBody();

	//platforms.create(600,400, 'ground');
	//platforms.create(50,250, 'ground');
	//platforms.create(750,220, 'ground');


	// Player Character
	player = this.physics.add.sprite(400, 0, 'dude');

	ground = this.add.sprite(400, 300, 'dude');

	//player.setBounce(0);
	player.setCollideWorldBounds(true);
	//player.body.setGravityY(10)

	//this.physics.moveToObject(player, ground, 1, 6000);
	this.physics.accelerateToObject(player, ground, 60, 300, 300);

	this.anims.create({

		key: 'left',
		frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }),
		frameRate: 10,
		repeat: -1

	});

	this.anims.create({

		key: 'turn',
		frames: [ { key: 'dude', frame: 4 } ],
		frameRate: 20

	});

	this.anims.create({

		key: 'right',
		frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }),
		frameRate: 10,
		repeat: -1

	});


	this.physics.add.collider(player, platforms);

	cursors = this.input.keyboard.createCursorKeys();


/*
	// Stars
	stars = this.physics.add.group(
	{

		key: 'star',
		repeat: 6,
		bounce: 0,
		setXY: { x: 400, y: 0, stepY: -500 },

	}
	);

	stars.children.iterate(function (child) {

		//this.body.moveToObject();
		//child.setBounceY(Phaser.Math.FloatBetween(0.4,0.8));

	});

	this.physics.add.collider(stars, platforms, starHitPlatform, null, this);
	this.physics.add.collider(stars, stars, starHitStar, null, this);
	this.physics.add.overlap(player, stars, collectStar, null, this);
*/

	// Bombs
	bombs = this.physics.add.group();
	this.physics.add.collider(bombs, platforms);
	this.physics.add.collider(player, bombs, hitBomb, null, this);



}

function update()
{

	cursorKeyInputHandler();

}

function cursorKeyInputHandler() {

	if (cursors.left.isDown)
	{

		//player.setVelocityX(-160);
		player.setPosition(player.x - 10, player.y);
		player.anims.play('left', true);

	}
	else if (cursors.right.isDown)
	{

		//player.setVelocityX(160);
		player.setPosition(player.x + 10, player.y);
		player.anims.play('right', true);

	}
	else if (cursors.down.isDown)
	{

		player.setPosition(player.x, player.y + 10);

	}	
	else
	{
		//player.setVelocityX(0);
		player.anims.play('turn');
	}

	if (cursors.up.isDown && player.body.touching.down)
	{
		player.setVelocityY(-330);
	}



}

function collectStar(player, star)
{
	star.disableBody(true, true);

	score += 10;
	scoreText.setText('Score: ' + score);

	if (stars.countActive(true) === 0)
	{
		stars.children.iterate(function(child) {

			child.enableBody(true, child.x, 0, true, true);

		});

		var x = (player.x < 400) ? Phaser.Math.Between(400,800) : Phaser.Math.Between(0,400);

		var bomb = bombs.create(x, 16, 'bomb');
		bomb.setBounce(1);
		bomb.setCollideWorldBounds(true);
		bomb.setVelocity(Phaser.Math.Between(-200, 200), 20);
		bomb.allowGravity = false;

	}
}

function hitBomb(player, bomb)
{
	this.physics.pause();
	player.setTint(0xff00000);
	player.anims.play('turn');
	gameOver = true;
}

function starHitStar(star1, star2)
{
 	star1.body.stop();
 	star2.body.stop();
}

function starHitPlatform(star, platform)
{

}


</script>

</body>
</html>

